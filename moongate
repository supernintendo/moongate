#!/bin/sh

# Update PATH to include binaries in _moongate/.
mkdir -p _moongate/elixir/bin
current_dir=`pwd`
modified_path=$current_dir/_moongate/elixir/bin:$PATH

# Get Elixir if needed.
PATH=$modified_path ./scripts/elixir.erl unix
has_elixir=$?

# Check world
world=${1:-default}

# Start the server.
if [ $has_elixir -eq 0 ];then
  MOONGATE_WORLD=$world PATH=$modified_path ./scripts/build.erl
  MOONGATE_WORLD=$world PATH=$modified_path iex -S mix
  PATH=$modified_path mix moongate.clean $world
else
  exit
fi